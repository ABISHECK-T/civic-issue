# Copilot / AI Agent Instructions

Purpose: short, actionable guidance to get an AI coding agent productive in this Flutter + Firebase app.

## Quick start (local) âœ…
- Install deps: `flutter pub get` (see `pubspec.yaml`).
- Run on Android (configured): `flutter run -d <device>` (android app configured via `android/app/google-services.json`).
- Run on Web (configured): `flutter run -d chrome` (`firebase_options.dart` contains web config).
- Run tests: `flutter test` (note: current test (`test/widget_test.dart`) is the Flutter template and likely needs updating).

## High-level architecture ğŸ—ï¸
- Flutter single-package app (entry: `lib/main.dart`).
- Firebase used for Auth and Firestore (packages in `pubspec.yaml`: `firebase_core`, `firebase_auth`, `cloud_firestore`).
- Firebase config generated by FlutterFire CLI: `lib/firebase_options.dart` and `android/app/google-services.json`.
- Simple client-side role model: users have `role: "citizen"` or `"government"` stored in `users` collection.
- Real-time data flow: citizens write to `issues` collection; Citizen UI uses a `StreamBuilder` to subscribe to `issues` filtered by `userId`.

## Important files to inspect ğŸ”§
- `lib/main.dart` â€” app entry, auth flows, UI patterns, data shapes (example writes/reads).
- `lib/firebase_options.dart` â€” auto-generated FlutterFire config (Android & Web configured). iOS/macOS/windows/linux **not** configured.
- `pubspec.yaml` â€” dependency list and SDK constraints.
- `firebase.json` / `firestore.rules` / `firestore.indexes.json` â€” Firebase project config and security rules (currently permissive until 2026-03-06).
- `android/app/build.gradle.kts` â€” Android Gradle config (release currently uses debug signing in this commit).
- `test/widget_test.dart` â€” outdated template tests; update needed to match current UI.

## Project-specific patterns & conventions ğŸ”
- Collections used:
  - `users` (document ID = auth UID) with fields: `name`, `email`, `role`, `createdAt`.
  - `issues` with fields: `userId`, `category`, `description`, `status` (e.g., "Pending"), `createdAt`.
- Role strings are literal: `"citizen"` and `"government"`. Client code branches on these strings (see `AuthPage` submit flow and navigation in `main.dart`).
- Realtime UI: `StreamBuilder` on Firestore snapshots is the pattern used for lists (see `CitizenDashboard`).
- Authentication: uses `FirebaseAuth.instance.*` directly in widgets (no DI or repository abstraction currently).

## Security & platform notes âš ï¸
- Firestore rules are currently permissive (allow read, write until 2026-03-06). **Do not assume production-safe rules.**
- `firebase_options.dart` only defines `web` and `android` platforms. Running on iOS/macOS/windows/linux will throw an UnsupportedError until those platforms are configured.
- Android release build currently uses debug signing (see `android/app/build.gradle.kts`).

## Tests & CI ğŸ§ª
- `test/widget_test.dart` is from the Flutter template and will fail against current `lib/main.dart`. Update tests to reflect real UI widgets, or add unit tests around Firestore interactions using the Firebase emulator.
- No `.github/workflows` present; CI is not configured in repoâ€”expect manual testing or add workflows if needed.

## Typical low-effort issues an AI agent can pick up âœ¨
- Replace or extend the template test to match `MyApp` and main flows (login, dashboards).
- Implement a Government dashboard Firestore query and a basic UI list for `issues`.
- Add a basic role-based client-side guard when navigating to government screens (there is storage of role in `users` collection).
- Add or document steps to configure Firebase for additional platforms using the FlutterFire CLI (`dart pub global activate flutterfire_cli` then `flutterfire configure`).
- Tighten Firestore rules to enforce role-based access (only migrate after tests / emulator coverage added).

---

If anything here is unclear or you want more/less verbosity in examples (e.g., exact code snippets for CRUD patterns), tell me which section to expand and I will iterate. âœ…
